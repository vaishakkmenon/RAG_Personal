# Query Rewriting Patterns Configuration
# Patterns are applied in priority order (highest first)
# First matching pattern wins

patterns:
  # PATTERN 1: Negative Inference (Priority: 100 - Highest)
  # Queries asking about entities that might not exist
  - name: negative_inference
    enabled: true
    priority: 100
    description: "Negative inference queries (Do I have X?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)do\s+i\s+have\s+(?:a|an|any)?\s*(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)have\s+i\s+(?:got|gotten|earned)\s+(?:a|an|any)?\s*(.+)\?'
          extract_groups: [1]
      min_score: 0.8
    rewrite_strategy:
      type: category_expansion
      entity_to_category:
        phd|doctorate|doctoral: "education degrees academic qualifications"
        azure.*cert: "certifications professional credentials"
        aws.*cert: "certifications professional credentials"
        gcp.*cert: "certifications professional credentials"
    test_cases:
      - input: "Do I have a PhD?"
        expected_output: "education degrees academic qualifications"
        expected_entities: {entity_1: "PhD"}
      - input: "Do I have Azure certifications?"
        expected_output: "certifications professional credentials"

  # PATTERN 2: Temporal Filtered Attributes (Priority: 95)
  # Queries asking for items filtered by temporal attributes
  - name: temporal_filtered_attributes
    enabled: true
    priority: 95
    description: "Temporal attribute filtering (Which X expire in Y?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)which\s+(.+?)\s+expire\s+in\s+(\d{4})'
          extract_groups: [1, 2]
        - pattern: '(?i)what\s+(.+?)\s+(?:expiring|expire)\s+(?:in|on)\s+(.+?)\?'
          extract_groups: [1, 2]
      min_score: 0.8
    rewrite_strategy:
      type: list_expansion
      template: "List all certifications with expiration dates"
    test_cases:
      - input: "Which certifications expire in 2028?"
        expected_output: "List all certifications with expiration dates"

  # PATTERN 3: Entity Verification (Priority: 90)
  # Yes/no questions about specific entities
  - name: entity_verification
    enabled: true
    priority: 90
    description: "Entity verification (Did I take X?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)did\s+i\s+take\s+(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)do\s+i\s+know\s+(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)have\s+i\s+(?:taken|completed|done)\s+(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)did\s+i\s+(?:graduate|earn)\s+(.+)\?'
          extract_groups: [1]
      min_score: 0.8
    rewrite_strategy:
      type: list_expansion
      template: "List all courses classes taken enrolled completed"
    test_cases:
      - input: "Did I take CS 350?"
        expected_output: "List all courses classes taken enrolled completed"
      - input: "Do I know Python?"
        expected_output: "List all courses classes taken enrolled completed"

  # PATTERN 4: Entity Specific Attributes (Priority: 85)
  # Queries asking for entities with specific attributes
  - name: entity_specific_attributes
    enabled: true
    priority: 85
    description: "Entity attribute filtering (What courses got B grade?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)what\s+courses.*\s+([A-F][+-]?)\s+grade'
          extract_groups: [1]
        - pattern: '(?i)(?:which|what)\s+(.+?)\s+(?:with|having)\s+(.+?)\?'
          extract_groups: [1, 2]
      min_score: 0.7
    rewrite_strategy:
      type: list_expansion
      template: "List all courses with grades and performance"
    test_cases:
      - input: "What courses did I get a B grade in?"
        expected_output: "List all courses with grades and performance"

  # PATTERN 5: Comparison/Context (Priority: 80)
  # Queries requiring comparison or context
  - name: comparison_context
    enabled: true
    priority: 80
    description: "Comparison queries (Was X the only...?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)was\s+(.+?)\s+the\s+only\s+(.+)\?'
          extract_groups: [1, 2]
        - pattern: '(?i)(?:compare|versus|vs)\s+(.+)\s+(?:and|to|with)\s+(.+)'
          extract_groups: [1, 2]
      min_score: 0.8
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "only": ["single", "sole", "unique"]
        "compare": ["versus", "difference", "contrast"]
    test_cases:
      - input: "Was CS 350 the only class to lower my GPA?"
        expected_output: "Was CS 350 the only single sole class to lower my GPA?"

  # PATTERN 6: Counting (Priority: 75)
  # Queries asking for counts
  - name: counting
    enabled: true
    priority: 75
    description: "Counting queries (How many X?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)how\s+many\s+(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)count\s+(?:of|the)?\s*(.+)'
          extract_groups: [1]
      min_score: 0.8
    rewrite_strategy:
      type: list_expansion
      template: "List all {entity}"
    test_cases:
      - input: "How many internships did I do at Maven Wave?"
        expected_output: "List all internships"
      - input: "How many certifications do I have?"
        expected_output: "List all certifications"

  # PATTERN 7: Temporal (Priority: 70)
  # Queries scoped to specific time periods
  - name: temporal
    enabled: true
    priority: 70
    description: "Temporal queries (What courses in Fall 2022?)"
    matching:
      type: keyword_presence
      keywords:
        - "Fall 2022"
        - "Spring 2022"
        - "Summer 2022"
        - "Fall 2023"
        - "Spring 2023"
        - "Summer 2023"
        - "Fall 2024"
        - "Spring 2024"
        - "Summer 2024"
        - "Fall 2025"
        - "Spring 2025"
      min_score: 0.5
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "Fall 2022": ["Fall 2022", "Fall Term 2022", "Autumn 2022", "September 2022", "October 2022", "November 2022", "December 2022"]
        "Spring 2022": ["Spring 2022", "Spring Term 2022", "January 2022", "February 2022", "March 2022", "April 2022", "May 2022"]
        "Summer 2022": ["Summer 2022", "Summer Term 2022", "June 2022", "July 2022", "August 2022"]
        "Fall 2023": ["Fall 2023", "Fall Term 2023", "Autumn 2023"]
        "Spring 2023": ["Spring 2023", "Spring Term 2023"]
        "Fall 2024": ["Fall 2024", "Fall Term 2024", "Autumn 2024"]
        "Spring 2024": ["Spring 2024", "Spring Term 2024"]
    test_cases:
      - input: "What courses did I take in Fall 2022?"
        expected_output: "What courses did I take in Fall 2022 Fall Term 2022 Autumn 2022 September 2022 October 2022 November 2022 December 2022?"

  # PATTERN 8: Education Level (Priority: 65)
  # Queries filtering by education level
  - name: education_level
    enabled: true
    priority: 65
    description: "Education level queries (What is my graduate GPA?)"
    matching:
      type: keyword_presence
      keywords:
        - "graduate GPA"
        - "undergraduate GPA"
        - "graduate"
        - "undergraduate"
        - "grad GPA"
        - "undergrad GPA"
      min_score: 0.5
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "graduate": ["graduate", "grad", "masters", "MS", "graduate-level"]
        "undergraduate": ["undergraduate", "undergrad", "bachelor", "BS", "undergraduate-level"]
    test_cases:
      - input: "What is my graduate GPA?"
        expected_output: "What is my graduate grad masters MS graduate-level GPA?"

  # PATTERN 9: Topic-Based (Priority: 60)
  # Queries filtering by topic or subject area
  - name: topic_based
    enabled: true
    priority: 60
    description: "Topic filtering (What AI courses have I taken?)"
    matching:
      type: keyword_presence
      keywords:
        - "AI courses"
        - "ML courses"
        - "machine learning"
        - "artificial intelligence"
        - "AI/ML"
      min_score: 0.5
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "AI": ["AI", "artificial intelligence", "machine learning", "ML", "deep learning", "neural networks", "NLP", "natural language processing", "computer vision"]
        "ML": ["ML", "machine learning", "AI", "artificial intelligence", "deep learning"]
    test_cases:
      - input: "What AI courses have I taken?"
        expected_output: "What AI artificial intelligence machine learning ML deep learning neural networks NLP natural language processing computer vision courses have I taken?"

  # PATTERN 10: Specific Entity Details (Priority: 55)
  # Queries asking for details about a known entity
  - name: specific_entity_details
    enabled: true
    priority: 55
    description: "Entity details (What did I do at UAB?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)what\s+did\s+i\s+do\s+at\s+(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)tell\s+me\s+about\s+(?:my)?\s*(.+)'
          extract_groups: [1]
      min_score: 0.7
    rewrite_strategy:
      type: list_expansion
      template: "{entity} role responsibilities duration achievements technologies"
    test_cases:
      - input: "What did I do at UAB?"
        expected_output: "UAB role responsibilities duration achievements technologies"
      - input: "Tell me about my RAG project"
        expected_output: "RAG project role responsibilities duration achievements technologies"

  # PATTERN 11: Honors/Awards (Priority: 50)
  # Queries about honors or awards
  - name: honors_awards
    enabled: true
    priority: 50
    description: "Honors verification (Did I graduate with honors?)"
    matching:
      type: keyword_presence
      keywords:
        - "honors"
        - "Summa Cum Laude"
        - "Magna Cum Laude"
        - "Cum Laude"
        - "Dean's List"
        - "awards"
        - "distinctions"
      min_score: 0.5
    rewrite_strategy:
      type: list_expansion
      template: "graduation honors academic distinctions awards achievements"
    test_cases:
      - input: "Did I graduate with honors?"
        expected_output: "graduation honors academic distinctions awards achievements"
      - input: "Did I graduate Summa Cum Laude?"
        expected_output: "graduation honors academic distinctions awards achievements"

  # PATTERN 12: List-Based Inventory (Priority: 40 - Lowest)
  # Well-formed inventory queries
  - name: list_based_inventory
    enabled: true
    priority: 40
    description: "Inventory queries (What degrees do I have?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)what\s+(?:degrees|certifications|skills|projects|languages)\s+'
          extract_groups: []
        - pattern: '(?i)where\s+have\s+i\s+worked'
          extract_groups: []
      min_score: 0.7
    rewrite_strategy:
      type: passthrough  # Already well-formed, minimal change
    test_cases:
      - input: "What degrees do I have?"
        expected_output: "What degrees do I have?"
      - input: "Where have I worked?"
        expected_output: "Where have I worked?"
