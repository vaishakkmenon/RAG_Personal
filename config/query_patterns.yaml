# Query Rewriting Patterns Configuration
# Patterns are applied in priority order (highest first)
# First matching pattern wins
#
# OPTIMIZATION NOTES (Dec 2025):
# - Most patterns DISABLED after evaluation showed they cause regressions
# - Only negative_inference pattern is enabled (helps with "Do I have X?" queries)
# - See QUERY_EXPANSION_ANALYSIS_AND_RECOMMENDATIONS.md for details

patterns:
  # ============================================================================
  # PATTERN 1: Negative Inference (ENABLED - The Only Pattern That Helps!)
  # ============================================================================
  # Queries asking about entities that might not exist
  - name: negative_inference
    enabled: true
    priority: 100
    description: "Negative inference queries (Do I have X?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)do\s+i\s+have\s+(?:a|an|any)?\s*(.+)\?'
          extract_groups: [1]
        - pattern: '(?i)have\s+i\s+(?:got|gotten|earned)\s+(?:a|an|any)?\s*(.+)\?'
          extract_groups: [1]
      min_score: 0.8
    rewrite_strategy:
      type: category_expansion
      entity_to_category:
        phd|doctorate|doctoral: "education degrees academic qualifications"
        azure.*cert: "certifications professional credentials"
        aws.*cert: "certifications professional credentials"
        gcp.*cert: "certifications professional credentials"
        terraform|docker|kubernetes: "technical skills devops tools infrastructure"
    test_cases:
      - input: "Do I have a PhD?"
        expected_output: "education degrees academic qualifications"
        expected_entities: {entity_1: "PhD"}
      - input: "Do I have Azure certifications?"
        expected_output: "certifications professional credentials"

  # ============================================================================
  # DISABLED PATTERNS (Cause Regressions)
  # ============================================================================
  # All patterns below are disabled due to performance regressions
  # See evaluation results in EVALUATION_SUMMARY_DEC_2025.md

  # PATTERN 2: Temporal Filtered Attributes (DISABLED)
  # Problem: Loses temporal context when expanding
  - name: temporal_filtered_attributes
    enabled: false
    priority: 95
    description: "Temporal attribute filtering (Which X expire in Y?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)which\s+(.+?)\s+expire\s+in\s+(\d{4})'
          extract_groups: [1, 2]
      min_score: 0.8
    rewrite_strategy:
      type: list_expansion
      template: "List all certifications with expiration dates"

  # PATTERN 3: Entity Verification (DISABLED)
  # Problem: Destroys specific keywords (CS 350, Fall 2022)
  # Caused 4 queries to go from perfect (1.0) to zero (0.0) recall
  - name: entity_verification
    enabled: false
    priority: 90
    description: "Entity verification (Did I take X?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)did\s+i\s+take\s+(.+)\?'
          extract_groups: [1]
      min_score: 0.8
    rewrite_strategy:
      type: list_expansion
      template: "List all courses classes taken enrolled completed"

  # PATTERN 4: Entity Specific Attributes (DISABLED)
  # Problem: Loses attribute filters (B grade → all grades)
  # Caused "What courses did I get a B grade in?" to fail completely
  - name: entity_specific_attributes
    enabled: false
    priority: 85
    description: "Entity attribute filtering (What courses got B grade?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)what\s+courses.*\s+([A-F][+-]?)\s+grade'
          extract_groups: [1]
      min_score: 0.7
    rewrite_strategy:
      type: list_expansion
      template: "List all courses with grades and performance"

  # PATTERN 5: Comparison/Context (DISABLED)
  - name: comparison_context
    enabled: false
    priority: 80
    description: "Comparison queries (Was X the only...?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)was\s+(.+?)\s+the\s+only\s+(.+)\?'
          extract_groups: [1, 2]
      min_score: 0.8
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "only": ["single", "sole", "unique"]

  # PATTERN 6: Counting (DISABLED)
  - name: counting
    enabled: false
    priority: 75
    description: "Counting queries (How many X?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)how\s+many\s+(.+)\?'
          extract_groups: [1]
      min_score: 0.8
    rewrite_strategy:
      type: list_expansion
      template: "List all {entity}"

  # PATTERN 7: Temporal (DISABLED)
  - name: temporal
    enabled: false
    priority: 70
    description: "Temporal queries (What courses in Fall 2022?)"
    matching:
      type: keyword_presence
      keywords:
        - "Fall 2022"
        - "Spring 2022"
      min_score: 0.5
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "Fall 2022": ["Fall 2022", "Fall Term 2022", "Autumn 2022"]

  # PATTERN 8: Education Level (DISABLED)
  - name: education_level
    enabled: false
    priority: 65
    description: "Education level queries (What is my graduate GPA?)"
    matching:
      type: keyword_presence
      keywords:
        - "graduate GPA"
        - "undergraduate GPA"
      min_score: 0.5
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "graduate": ["graduate", "grad", "masters", "MS"]

  # PATTERN 9: Topic-Based (DISABLED)
  # Problem: Matches wrong entities (AI courses → AWS AI Practitioner cert)
  - name: topic_based
    enabled: false
    priority: 60
    description: "Topic filtering (What AI courses have I taken?)"
    matching:
      type: keyword_presence
      keywords:
        - "AI courses"
        - "ML courses"
      min_score: 0.5
    rewrite_strategy:
      type: synonym_expansion
      synonyms:
        "AI": ["AI", "artificial intelligence", "machine learning"]

  # PATTERN 10: Specific Entity Details (DISABLED)
  - name: specific_entity_details
    enabled: false
    priority: 55
    description: "Entity details (What did I do at UAB?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)what\s+did\s+i\s+do\s+at\s+(.+)\?'
          extract_groups: [1]
      min_score: 0.7
    rewrite_strategy:
      type: list_expansion
      template: "{entity} role responsibilities duration achievements"

  # PATTERN 11: Honors/Awards (DISABLED)
  - name: honors_awards
    enabled: false
    priority: 50
    description: "Honors verification (Did I graduate with honors?)"
    matching:
      type: keyword_presence
      keywords:
        - "honors"
        - "Summa Cum Laude"
      min_score: 0.5
    rewrite_strategy:
      type: list_expansion
      template: "graduation honors academic distinctions awards"

  # PATTERN 12: List-Based Inventory (DISABLED)
  - name: list_based_inventory
    enabled: false
    priority: 40
    description: "Inventory queries (What degrees do I have?)"
    matching:
      type: regex_list
      rules:
        - pattern: '(?i)what\s+(?:degrees|certifications|skills|projects|languages)\s+'
          extract_groups: []
      min_score: 0.7
    rewrite_strategy:
      type: passthrough
