# ============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION TEMPLATE
# ============================================================================
# INSTRUCTIONS:
# 1. Copy this file to .env:  cp .env.production.template .env
# 2. Replace all <CHANGE_ME> placeholders with secure values.
# 3. Verify defaults match your deployment needs.
# ============================================================================

# ============ General Environment ============
ENV=production
LOG_LEVEL=info
APP_TITLE="Personal RAG System (Production)"

# ============ Security (CRITICAL) ============
# 1. API Keys (Supports Rotation)
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
API_KEYS=<CHANGE_ME_SECURE_RANDOM_HEX>
# Legacy single key support (optional if API_KEYS is set)
# API_KEY=<CHANGE_ME_SECURE_RANDOM_HEX>

# 2. Secrets
REDIS_PASSWORD=<CHANGE_ME_SECURE_REDIS_PASSWORD>
POSTGRES_PASSWORD=<CHANGE_ME_SECURE_POSTGRES_PASSWORD>
GRAFANA_ADMIN_PASSWORD=<CHANGE_ME_SECURE_GRAFANA_PASSWORD>

# 3. Network Security
SESSION_REQUIRE_HTTPS=true
ALLOWED_ORIGINS=https://your-domain.com
MAX_BYTES=32768

# ============ LLM Provider (Groq) ============
LLM_PROVIDER=groq
LLM_GROQ_API_KEY=<CHANGE_ME_GROQ_API_KEY>
# Production Model: 70b-versatile (Smart) or 8b-instant (Fast)
LLM_GROQ_MODEL=llama-3.1-70b-versatile
LLM_GROQ_TIER=free
LLM_TEMPERATURE=0.1
LLM_MAX_TOKENS=1000
LLM_NUM_CTX=4096

# ============ Retrieval Tuning ============
# Embeddings
EMBED_MODEL=BAAI/bge-small-en-v1.5

# Search Parameters
TOP_K=5
MAX_DISTANCE=0.60
NULL_THRESHOLD=0.60
CHUNK_SIZE=800
CHUNK_OVERLAP=120

# Hybrid Reranking (Phase 1)
RERANK=true
RERANK_LEX_WEIGHT=0.3
RERANK_RETRIEVAL_K=50

# Cross-Encoder (Phase 2)
CROSS_ENCODER_ENABLED=true
CROSS_ENCODER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
CROSS_ENCODER_MAX_LATENCY_MS=500.0

# Negative Inference
NEGATIVE_INFERENCE_METHOD=gap_based
NEGATIVE_INFERENCE_THRESHOLD=0.37

# ============ Query Router & Rewriter ============
USE_ROUTER=false
QUERY_REWRITER_ENABLED=true
QUERY_REWRITER_CONFIG=config/query_patterns.yaml
QUERY_REWRITER_HOT_RELOAD=false  # Disable hot-reload in production for stability
QUERY_REWRITER_ANALYTICS=true

# ============ Session & Caching (Redis) ============
SESSION_STORAGE_BACKEND=redis
SESSION_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0
SESSION_MAX_TOTAL_SESSIONS=1000
SESSION_MAX_SESSIONS_PER_IP=100
SESSION_QUERIES_PER_HOUR=1000
SESSION_TTL_SECONDS=21600
SESSION_MAX_HISTORY_TOKENS=250
SESSION_MAX_HISTORY_TURNS=5

# Response Caching
RESPONSE_CACHE_ENABLED=true
RESPONSE_CACHE_TTL_SECONDS=3600
RESPONSE_CACHE_MAX_SIZE_MB=100

# ============ Ingestion ============
INGEST_ALLOWED_EXTENSIONS=txt,md
INGEST_MAX_FILE_SIZE=10485760
DOCS_DIR=/workspace/data/mds
CHROMA_DIR=/workspace/data/chroma
COLLECTION_NAME=personal_rag

# ============ Prompt Guard ============
PROMPT_GUARD_ENABLED=true
PROMPT_GUARD_MODEL=meta-llama/llama-prompt-guard-2-86m
PROMPT_GUARD_FAIL_OPEN=true

# ============ Infrastructure ============
# PostgreSQL
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=rag_db
POSTGRES_USER=rag_user

# Monitoring
GRAFANA_ADMIN_USER=admin
UVICORN_WORKERS=4
