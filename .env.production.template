# ==========================================
# Production Environment Configuration
# ==========================================
# INSTRUCTIONS:
# 1. Copy this file to .env.production:  cp .env.production.template .env.production
# 2. Generate secure keys for all CHANGEME values
# 3. Update domain and service configurations
# 4. NEVER commit .env.production to version control!
# ==========================================

# ==============================================================================
# Security (CRITICAL - MUST CHANGE!)
# ==============================================================================

# API authentication key - MUST be changed!
# Generate with: openssl rand -hex 32
API_KEY=CHANGEME-generate-with-openssl-rand-hex-32

# Redis password - MUST be changed!
# Generate with: openssl rand -base64 32
REDIS_PASSWORD=CHANGEME-generate-with-openssl-rand-base64-32

# ==============================================================================
# Environment
# ==============================================================================
ENV=production

# ==============================================================================
# LLM Provider (Groq-only in production)
# ==============================================================================
LLM_PROVIDER=groq

# Groq API key - MUST be changed!
# Get your key at: https://console.groq.com/keys
LLM_GROQ_API_KEY=CHANGEME-your-actual-groq-api-key
LLM_GROQ_MODEL=llama-3.1-8b-instant

# Temperature and tokens
LLM_TEMPERATURE=0.1
LLM_MAX_TOKENS=1000

# ==============================================================================
# CORS & Domain Configuration
# ==============================================================================

# Allowed origins for CORS - MUST update with your domain!
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# ==============================================================================
# Redis Session Storage
# ==============================================================================
SESSION_STORAGE_BACKEND=redis
SESSION_REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379/0

# Session limits (stricter for production)
SESSION_MAX_TOTAL_SESSIONS=1000
SESSION_MAX_PER_IP=3
SESSION_QUERIES_PER_HOUR=20
SESSION_TTL_SECONDS=21600

# HTTPS required for production
SESSION_REQUIRE_HTTPS=true

# Conversation history limits
SESSION_MAX_HISTORY_TOKENS=250
SESSION_MAX_HISTORY_TURNS=3

# ==============================================================================
# Response Caching
# ==============================================================================
RESPONSE_CACHE_ENABLED=true
RESPONSE_CACHE_TTL_SECONDS=3600
RESPONSE_CACHE_MAX_SIZE_MB=100
RESPONSE_CACHE_PROMPT_VERSION=1

# ==============================================================================
# Embedding Model
# ==============================================================================
EMBED_MODEL=BAAI/bge-small-en-v1.5

# ==============================================================================
# Data Paths (in Docker container)
# ==============================================================================
DOCS_DIR=/workspace/data/mds
CHROMA_DIR=/workspace/data/chroma
COLLECTION_NAME=personal_rag

# ==============================================================================
# Retrieval Settings
# ==============================================================================
CHUNK_SIZE=800
CHUNK_OVERLAP=120
TOP_K=5
MAX_DISTANCE=0.60
NULL_THRESHOLD=0.60
RERANK=true
RERANK_LEX_WEIGHT=0.3
RERANK_RETRIEVAL_K=50

# ==============================================================================
# Cross-Encoder Reranking
# ==============================================================================
CROSS_ENCODER_ENABLED=true
CROSS_ENCODER_MODEL=cross-encoder/ms-marco-MiniLM-L-6-v2
CROSS_ENCODER_CACHE_DIR=/tmp/cross-encoder
CROSS_ENCODER_RETRIEVAL_K=15
CROSS_ENCODER_TOP_K=5
CROSS_ENCODER_MAX_LATENCY_MS=500.0

# ==============================================================================
# Prompt Guard (Security)
# ==============================================================================
PROMPT_GUARD_ENABLED=true
PROMPT_GUARD_MODEL=llama-3.1-8b-instant
PROMPT_GUARD_FAIL_OPEN=false
PROMPT_GUARD_TIMEOUT_SECONDS=5

# ==============================================================================
# Query Processing
# ==============================================================================
USE_ROUTER=false
QUERY_REWRITER_ENABLED=true
QUERY_REWRITER_CONFIG=config/query_patterns.yaml
QUERY_REWRITER_HOT_RELOAD=false
NEGATIVE_INFERENCE_METHOD=gap_based
NEGATIVE_INFERENCE_THRESHOLD=0.37

# ==============================================================================
# HTTP Settings
# ==============================================================================
MAX_BYTES=32768

# ==============================================================================
# Logging (use INFO in production, DEBUG only for troubleshooting)
# ==============================================================================
LOG_LEVEL=INFO

# ==============================================================================
# Monitoring - MUST change passwords!
# ==============================================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGEME-secure-grafana-password
GRAFANA_ALLOW_SIGNUP=false
GRAFANA_ANALYTICS_REPORTING=false
PROMETHEUS_RETENTION_DAYS=7
